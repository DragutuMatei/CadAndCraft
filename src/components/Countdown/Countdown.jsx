import React, { useState, useEffect, useRef } from 'react';
import { BsArrowRightCircle } from 'react-icons/bs';
import './Countdown.scss';

// Simplified Logo Component (Static)
const BackgroundLogo = () => (
  <div className="bg-logo-item">
    <svg viewBox="0 0 205 105" fill="none" xmlns="http://www.w3.org/2000/svg">
       <path d="M118.405 37.4244C118.405 41.6766 117.412 44.9495 115.428 47.2431C113.444 49.5238 110.615 50.6641 106.943 50.6641C102.449 50.6641 98.806 47.021 98.806 42.527V31.568C98.806 27.7145 101.93 24.5906 105.783 24.5906C110.01 24.5906 113.167 25.6536 115.254 27.7797C117.354 29.8929 118.405 33.1078 118.405 37.4244ZM112.664 37.4244C112.664 34.4994 112.11 32.3669 111.002 31.0268C109.907 29.6738 108.135 28.9974 105.687 28.9974C105.036 28.9974 104.508 29.5252 104.508 30.1764V44.2859C104.508 45.3747 105.39 46.2573 106.479 46.2573C110.603 46.2573 112.664 43.313 112.664 37.4244Z" fill="#003566"/>
       <path d="M95.0361 47.1808C95.5988 48.8983 94.3192 50.6641 92.5119 50.6641C91.3197 50.6641 90.2735 49.8696 89.9533 48.7212L89.6058 47.4749C89.0803 45.5898 87.363 44.2858 85.406 44.2858H83.2139C81.2569 44.2858 79.5396 45.5898 79.0141 47.4749L78.6682 48.7155C78.3471 49.8673 77.2978 50.6641 76.1021 50.6641C74.2887 50.6641 73.0053 48.8917 73.571 47.1689L79.9487 27.7479C80.5673 25.864 82.3259 24.5905 84.3088 24.5905C86.2928 24.5905 88.0521 25.8654 88.6699 27.7508L95.0361 47.1808ZM84.8511 30.4662C84.7281 29.9677 83.8812 29.965 83.7515 30.4619C83.7444 30.4889 83.7373 30.5162 83.7301 30.5436C83.5177 31.383 82.9323 33.5044 81.9737 36.9078C81.5375 38.4564 82.7 39.995 84.3088 39.995C85.9184 39.995 87.0808 38.4548 86.6429 36.906C85.6616 33.4353 85.0644 31.2887 84.8511 30.4662Z" fill="#003566"/>
       <path d="M160.471 57.7714C158.304 57.7714 156.548 59.528 156.548 61.695V76.5873C156.548 78.1618 155.271 79.4382 153.697 79.4382C152.122 79.4382 150.846 78.1618 150.846 76.5873V61.695C150.846 59.528 149.089 57.7714 146.922 57.7714H144.554C143.695 57.7714 142.999 57.0753 142.999 56.2167C142.999 55.3581 143.695 54.662 144.554 54.662H162.84C163.699 54.662 164.395 55.3581 164.395 56.2167C164.395 57.0753 163.699 57.7714 162.84 57.7714H160.471Z" fill="#003566"/>
       <path d="M130.687 57.7714C128.637 57.7714 126.976 59.4329 126.976 61.4824C126.976 63.5319 128.637 65.1934 130.687 65.1934H136.775C137.992 65.1934 138.979 66.1799 138.979 67.3968C138.979 68.6137 137.992 69.6002 136.775 69.6002H131.895C129.178 69.6002 126.976 71.8025 126.976 74.5192V76.5873C126.976 78.1618 125.7 79.4382 124.125 79.4382C122.551 79.4382 121.274 78.1618 121.274 76.5873V62.4314C121.274 57.4197 125.337 53.3569 130.349 53.3569H137.216C138.435 53.3569 139.423 54.3451 139.423 55.5641C139.423 56.7832 138.435 57.7714 137.216 57.7714H130.687Z" fill="#003566"/>
       <path d="M116.886 75.9548C117.449 77.6723 116.169 79.4381 114.362 79.4381C113.169 79.4381 112.123 78.6437 111.803 77.4952L111.456 76.249C110.93 74.3638 109.213 73.0598 107.256 73.0598H105.064C103.107 73.0598 101.389 74.3638 100.864 76.249L100.518 77.4895C100.197 78.6413 99.1476 79.4381 97.9518 79.4381C96.1384 79.4381 94.855 77.6657 95.4208 75.9429L101.798 56.5219C102.417 54.638 104.176 53.3645 106.159 53.3645C108.143 53.3645 109.902 54.6395 110.52 56.5248L116.886 75.9548ZM106.701 59.2403C106.578 58.7417 105.731 58.7391 105.601 59.2359C105.594 59.263 105.587 59.2902 105.58 59.3176C105.367 60.157 104.782 62.2784 103.823 65.6819C103.387 67.2305 104.55 68.769 106.159 68.769C107.768 68.769 108.931 67.2288 108.493 65.68C107.511 62.2093 106.914 60.0627 106.701 59.2403Z" fill="#003566"/>
       <path d="M89.3931 79.4381C88.4078 79.4381 87.499 78.9069 87.0155 78.0484L82.7982 70.559C82.4243 69.895 81.7215 69.4841 80.9595 69.4841C79.794 69.4841 78.8492 70.4289 78.8492 71.5944V76.5872C78.8492 78.1617 77.5729 79.4381 75.9984 79.4381C74.4239 79.4381 73.1475 78.1617 73.1475 76.5872V62.9126C73.1475 57.6394 77.4223 53.3645 82.6955 53.3645C86.0972 53.3645 88.6421 54.0281 90.3301 55.3553C92.0181 56.6825 92.8621 58.596 92.8621 61.0958C92.8621 62.8611 92.3853 64.3622 91.4318 65.5992C89.9395 67.5352 88.6953 70.2492 89.954 72.3446L91.7321 75.3046C92.8245 77.1232 91.5146 79.4381 89.3931 79.4381ZM87.1216 61.3277C87.1216 60.1165 86.7222 59.2274 85.9233 58.6604C85.1244 58.0806 83.8488 57.7907 82.0963 57.7907C80.303 57.7907 78.8492 59.2444 78.8492 61.0378V61.6563C78.8492 63.535 80.3722 65.058 82.251 65.058C85.4981 65.058 87.1216 63.8146 87.1216 61.3277Z" fill="#003566"/>
       <path d="M48.5159 51.8559C48.5159 58.0261 49.1636 62.784 50.4589 66.1295C51.7542 69.4751 53.688 71.1479 56.2601 71.1479C58.5769 71.1479 60.4295 69.1497 61.8178 65.1533C62.5631 63.0081 64.7697 61.6328 66.9552 62.2497C68.9496 62.8127 70.1865 64.836 69.6169 66.8286C66.9754 76.0703 62.4954 80.6911 56.1769 80.6911C50.977 80.6911 47.0078 78.2505 44.2691 73.3692C41.5489 68.4605 40.1888 61.2894 40.1888 51.8559C40.1888 32.9616 45.4442 23.5144 55.9548 23.5144C59.3967 23.5144 62.2741 24.8581 64.5872 27.5456C66.4058 29.6417 67.8472 32.5301 68.9115 36.211C69.4539 38.087 68.3572 40.0065 66.5197 40.6673C64.2419 41.4863 61.8451 40.0313 60.9467 37.7837C60.5958 36.9057 60.1994 36.1393 59.7575 35.4845C58.6842 33.8666 57.4537 33.0576 56.0658 33.0576C51.0326 33.0576 48.5159 39.3237 48.5159 51.8559Z" fill="#003566"/>
       <path d="M146.957 32.1946C147.7 32.4135 148.224 32.8846 148.528 33.6077C152.586 33.6487 156.643 33.7141 160.696 33.804C161.624 34.1083 162.226 34.7232 162.501 35.6487V36.9827C162.123 38.0671 161.364 38.6959 160.224 38.8674V54.7493H158.576V38.8674H156.849V54.7493H155.201V38.8674H148.685C148.698 39.2346 148.684 39.6008 148.645 39.9661C148.179 41.4169 147.682 42.8561 147.154 44.2835C147.083 44.3776 146.992 44.4432 146.879 44.4797C146.304 44.519 145.728 44.5328 145.152 44.5198C145.165 45.0959 145.152 45.6714 145.113 46.2463C144.914 47.3611 144.286 48.1199 143.229 48.5227C143.123 50.1922 143.411 51.7888 144.092 53.3118C144.534 54.1149 145.201 54.6248 146.094 54.842C146.152 54.8482 146.211 54.8548 146.269 54.8606C146.244 54.8706 142.81 56.2428 143.082 55.4788C143.165 54.8302 142.508 53.9214 142.287 53.3899C141.737 51.7898 141.489 50.1414 141.541 48.4446C140.744 48.1838 140.181 47.6602 139.853 46.8743C139.676 46.101 139.611 45.3161 139.657 44.5198C139.081 44.5328 138.505 44.519 137.93 44.4797C137.818 44.4432 137.726 44.3777 137.655 44.2835C137.127 42.8561 136.63 41.4169 136.164 39.9661C136.124 39.6008 136.111 39.2346 136.124 38.8674H129.609V54.7493H127.96V38.8674H126.233V54.7493H124.584V38.8674C123.445 38.6958 122.686 38.0671 122.308 36.9827V35.6487C122.583 34.7231 123.185 34.1082 124.114 33.804C128.167 33.7141 132.223 33.6487 136.282 33.6077C136.588 32.8826 137.111 32.4115 137.851 32.1946H146.957ZM141.305 44.5198C141.277 45.1269 141.317 45.7285 141.423 46.3245C141.511 46.4912 141.629 46.636 141.777 46.7571C142.45 47.116 142.986 46.9714 143.386 46.3245C143.493 45.7285 143.531 45.1269 143.503 44.5198H141.305ZM138.087 40.4368C138.365 41.2694 138.626 42.1074 138.872 42.9495H145.937C146.167 42.1296 146.428 41.3184 146.722 40.5159C143.844 40.4374 140.966 40.4106 138.087 40.4368ZM142.068 32.804C141.687 32.804 141.351 32.883 141.06 33.0422C140.776 33.2015 140.555 33.4205 140.396 33.6975C140.244 33.9745 140.167 34.2859 140.167 34.6321C140.167 34.826 140.191 35.0135 140.24 35.1936C140.295 35.3666 140.371 35.5535 140.468 35.7542C140.579 35.9481 140.683 36.1213 140.78 36.2737C140.323 36.613 139.976 36.9177 139.741 37.1878C139.505 37.4578 139.388 37.773 139.388 38.1331C139.388 38.3963 139.464 38.6428 139.617 38.8713C139.769 39.0996 140.001 39.2866 140.312 39.4319C140.624 39.5704 141.012 39.6399 141.476 39.6399C142.3 39.6399 142.976 39.4039 143.502 38.9329C144.042 39.3206 144.42 39.5148 144.634 39.5149H146.151C146.172 39.5149 146.182 39.4978 146.182 39.4631C146.189 39.4216 146.179 39.3978 146.151 39.3909C145.929 39.3423 145.635 39.2176 145.268 39.0169C144.908 38.816 144.51 38.5523 144.074 38.2268C144.309 37.8528 144.517 37.354 144.697 36.7307C144.752 36.5231 144.805 36.3745 144.853 36.2844C144.901 36.1876 144.981 36.118 145.091 36.0764C145.202 36.028 145.365 36.0032 145.58 36.0032C145.6 36.0032 145.611 35.9829 145.611 35.9417C145.611 35.9001 145.6 35.8792 145.58 35.8792L143.201 35.8889C143.18 35.8889 143.169 35.91 143.169 35.9514C143.176 35.993 143.187 36.0139 143.201 36.0139C143.498 36.0139 143.706 36.097 143.824 36.2629C143.948 36.4223 144.011 36.6792 144.011 37.0325C144.011 37.427 143.956 37.7662 143.845 38.0501C142.924 37.3366 142.206 36.5924 141.694 35.8167C142.109 35.5396 142.422 35.3245 142.629 35.1721C142.837 35.0129 143.017 34.8224 143.169 34.6008C143.329 34.3723 143.409 34.1191 143.409 33.842C143.409 33.5029 143.284 33.2466 143.035 33.0735C142.792 32.8934 142.47 32.804 142.068 32.804ZM124.664 35.3342C124.437 35.4425 124.241 35.6002 124.075 35.8059C123.814 36.3976 123.958 36.855 124.506 37.179C128.379 37.2182 132.252 37.2321 136.124 37.219V35.3342H124.664ZM148.685 35.3342V37.219C152.558 37.2321 156.431 37.2182 160.303 37.179C160.469 37.0894 160.613 36.9722 160.735 36.8264C161.027 36.1428 160.831 35.6588 160.146 35.3743C156.326 35.335 152.505 35.3212 148.685 35.3342ZM141.653 33.0637C141.895 33.0638 142.089 33.1504 142.235 33.3235C142.387 33.4966 142.463 33.7358 142.463 34.0403C142.463 34.3518 142.387 34.6357 142.235 34.8919C142.082 35.1481 141.867 35.3975 141.59 35.6399C141.209 35.0097 141.019 34.428 141.019 33.8948C141.019 33.3407 141.23 33.0637 141.653 33.0637Z" fill="#003566"/>
    </svg>
  </div>
);

const Countdown = () => {
  const [expiryDate] = useState(() => {
    const now = new Date();
    const currentYear = now.getFullYear();
    // February 2nd
    let target = new Date(currentYear, 1, 2); 
    if (now > target) target.setFullYear(currentYear + 1);
    return target;
  });

  const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0 });
  const [isVisible, setIsVisible] = useState(false);
  const sectionRef = useRef(null);

  const formatNumber = (num) => num < 10 ? `0${num}` : num;

  useEffect(() => {
    const interval = setInterval(() => {
      const now = new Date();
      const difference = expiryDate - now;
      if (difference <= 0) {
        clearInterval(interval);
        setTimeLeft({ days: 0, hours: 0, minutes: 0, seconds: 0 });
      } else {
        const days = Math.floor(difference / (1000 * 60 * 60 * 24));
        const hours = Math.floor((difference / (1000 * 60 * 60)) % 24);
        const minutes = Math.floor((difference / 1000 / 60) % 60);
        const seconds = Math.floor((difference / 1000) % 60);
        setTimeLeft({ days, hours, minutes, seconds });
      }
    }, 1000);
    return () => clearInterval(interval);
  }, [expiryDate]);

  useEffect(() => {
    const observer = new IntersectionObserver(
      ([entry]) => {
        if (entry.isIntersecting) {
          setIsVisible(true);
          observer.unobserve(entry.target);
        }
      },
      { threshold: 0.2 }
    );
    if (sectionRef.current) observer.observe(sectionRef.current);
    return () => { if (sectionRef.current) observer.unobserve(sectionRef.current); };
  }, []);

  // --- RESPONSIVE LOGO GRID GENERATION ---
  const logoCount = 100; // Enough to fill screen
  const backgroundElements = Array.from({ length: logoCount }).map((_, index) => (
      <BackgroundLogo key={index} />
  ));

  return (
    <section ref={sectionRef} className={`countdown ${isVisible ? 'countdown--visible' : ''}`}>
      
      {/* 1. Static Responsive Grid Background */}
      <div className="countdown__background-grid">
        {backgroundElements}
      </div>

      {/* 2. Header (Green Banner) */}
      <div className="countdown__header">
          <div className="green-banner">
              <h2>INSCRIERILE SUNT</h2>
              <h1>DESCHISE!</h1>
          </div>
      </div>

      {/* 3. Timer + Button */}
      <div className="countdown__container">
        <div className="countdown__timer">
            <div className="time-row">
                <div className="time-box"><span className="number">{formatNumber(timeLeft.days)}</span><span className="label">zile</span></div>
                <div className="time-box"><span className="number">{formatNumber(timeLeft.hours)}</span><span className="label">ore</span></div>
            </div>
            <div className="time-row">
                <div className="time-box"><span className="number">{formatNumber(timeLeft.minutes)}</span><span className="label">minute</span></div>
                <div className="time-box"><span className="number">{formatNumber(timeLeft.seconds)}</span><span className="label">secunde</span></div>
            </div>
        </div>

        <button className="btn-register">
            INSCRIE-TE AICI <BsArrowRightCircle className="icon" />
        </button>
      </div>
    </section>
  );
};

export default Countdown;